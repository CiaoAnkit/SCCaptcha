<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <title>ReCap</title>

    <meta name="description" content="Captcha">
    <meta name="author" content="Prototype for ReCaptcha">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="./style.css">

  </head>
  <body>

    <center>
      <header>

	<nav>
	  <span>[<a href="/about">Single</a>]</span>
	  <span>[<a href="/verbose.html">Verbose</a>]</span>
	</nav>

      </header>
      <main>

	<h1 class="title">Captcha</h1>
	<table>
	  <thead>
	    <tr>
	      <th>Sensor</th>
	      <th>Support</th>
	      <th>Captcha</th>
	    </tr>
	  </thead>
	  <tbody>
	    <tr id="acc">
	      <td data-column="Sensor">Accelerometer</td>
	      <td data-column="Support">❌</td>
	      <td data-column="Captcha">Give a slight jerk to ur device</td>
	    </tr>
	    <tr id="gyro">
	      <td data-column="Sensor">Gyroscope</td>
	      <td data-column="Support">❌</td>
	      <td data-column="Captcha">Flip your phone on the table</td>
	    </tr>
	    <tr id="mag">
	      <td data-column="Sensor">Magnetometer</td>
	      <td data-column="Support">❌</td>
	      <td data-column="Captcha">Rotate the device horizontally about 90 degrees</td>
	    </tr>
	    <tr id="als">
	      <td data-column="Sensor">Ambient Light Sensor</td>
	      <td data-column="Support">❌</td>
	      <td data-column="Captcha">Cover the sensor for two seconds.</td>
	    </tr>
	  </tbody>
	</table>
    </center>
    <<script>
      if("Accelerometer" in window)
      {
	      document.getElementById("acc").children[1].innerHTML="✅";
	      const acc = new Accelerometer();
	      acc.start();
	      oax = acc.x;
	      oay = acc.y;
	      oaz = acc.z;
	      function foo() {
		      // console.log(oax);
		      if(acc.x-oax>3)
		      {
			      document.getElementById("acc").children[2].innerHTML="✅";
			      acc.stop();
			      return;
		      }
		      oax = acc.x;
		      setTimeout(foo, 20);
	      }
	      foo();
      }
      if("Gyroscope" in window)
      {
	      document.getElementById("gyro").children[1].innerHTML="✅";
	      const gyro = new Gyroscope();
	      gyro.start();
	      ogx = acc.x;
	      ogy = acc.y;
	      ogz = acc.z;
	      function foo() {
		      if( Math.abs(gyro.y-ogy)>3)
		      {
			      document.getElementById("gyro").children[2].innerHTML="✅";
			      gyro.stop();
			      return;
		      }
		      ogy = gyro.y;
		      setTimeout(foo, 50);
	      }
	      foo();
      }
      if("AmbientLightSensor" in window)
      {
	      document.getElementById("als").children[1].innerHTML="✅";
	      const als = new AmbientLightSensor();
	      als.start();
	      alsl = als.illuminance;
	      function foo() {
		      // console.log(alsl);
		      if(alsl && (alsl - als.illuminance) > 250)
		      {
			      document.getElementById("als").children[2].innerHTML="✅";
			      als.stop();
			      return;
		      }
		      alsl = als.illuminance;
		      setTimeout(foo, 1000);
	      }
	      foo();
      }
      if("Magnetometer" in window)
      {

	      document.getElementById("mag").children[1].innerHTML="✅";
	      const mag = new Magnetometer();
	      mag.start();
	      omx = mag.x;
	      omy = mag.y;
	      omz = mag.z;
	      function foo() {
		      // console.log("mag", omx);
		      if(omx && Math.abs(mag.x-omx)>10)
		      {
			      document.getElementById("mag").children[2].innerHTML="✅";
			      mag.stop();
			      return;
		      }
		      omx = mag.x;
		      setTimeout(foo, 1000);
	      }
	      foo();
      }

    </script>

    <!--    <footer> -->
    <!--      <p id="footer-note"> -->
    <!-- &copy Copyright 2022 -->
    <!-- <a href="./index.html">ReCap</a>. -->
    <!-- All rights reserved. -->
    <!--      </p> -->
    <!--    </footer> -->
  </body>
</html>
